<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">

<!-- Wichtig gegen Zoom + für iOS-Standalone -->
<meta name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">

<!-- iOS "App"-Modus (wichtig für iOS 12.5 Home-Bildschirm Vollbild) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Bühnen-Timer">

<title>Bühnen-Timer</title>

<style>
html, body{
  height:100%;
  margin:0;
  font-family:-apple-system,system-ui,Arial,sans-serif;
}

/* =====================
   HINTERGRUND-FARBEN
   ===================== */
body.bg-song{ background:#18b65a; color:#000; }
body.bg-talk{ background:#ffd500; color:#000; }
body.bg-alert{ background:#d60000; color:#fff; }
body{ transition:background 120ms linear; }

/* Blink */
@keyframes blink{
  0%{ filter:brightness(1); }
  50%{ filter:brightness(0.55); }
  100%{ filter:brightness(1); }
}
body.blink{ animation:blink 0.6s linear infinite; }

/* iOS: weniger Auswahl/Zoom-Gefummel */
*{
  -webkit-tap-highlight-color: transparent;
}
button{
  touch-action: manipulation; /* hilft gegen Doppeltipp-Zoom in vielen Fällen */
  -webkit-user-select:none;
  user-select:none;
}

/* =====================
   LAYOUT
   ===================== */
.wrap{
  height:100%;
  display:flex;
  flex-direction:column;
}

/* =====================
   TOP-BAR  (NEU: Grid statt absolute -> KEINE Überlappung)
   ===================== */
.top{
  height:170px;
  border-bottom:4px solid rgba(0,0,0,0.25);
  display:grid;
  align-items:center;
  grid-template-columns: 1fr 1fr auto 1fr 1fr; /* Start | Stop | Restzeit | Zurück | Weiter */
  grid-template-rows: 1fr auto;               /* Buttons oben | Titel unten */
  gap:10px 14px;
  padding:10px 14px 12px;
  box-sizing:border-box;
}

/* Buttons bekommen feste "Bühnen"-Höhe, aber schmaler in der Breite */
.top button{
  height:100%;
  min-height:110px;              /* groß antippbar */
  width:100%;
  max-width: 260px;              /* verhindert zu breite Buttons */
  padding:0 18px;
  font-size:34px;
  font-weight:900;
  border-radius:18px;
  border:5px solid rgba(0,0,0,0.45);
  background:#fff;
  box-shadow:0 6px 0 rgba(0,0,0,0.35);
  justify-self:stretch;
}

.top button:active{
  transform:translateY(4px);
  box-shadow:0 2px 0 rgba(0,0,0,0.4);
}

.btn-start{ grid-column:1; grid-row:1; }
.btn-stop { grid-column:2; grid-row:1; }
.btn-prev { grid-column:4; grid-row:1; }
.btn-next { grid-column:5; grid-row:1; }

/* =====================
   RESTLAUFZEIT – mittig, eigene Spalte => überlappt NIE
   ===================== */
.pill{
  grid-column:3;
  grid-row:1;
  justify-self:center;
  align-self:center;

  font-size:92px;
  font-weight:900;
  padding:10px 24px;
  border:5px solid #000;
  border-radius:22px;
  background:#fff;
  color:#000;
  line-height:1;
  box-shadow:0 8px 0 rgba(0,0,0,0.35);
}

/* Aktueller Abschnitt (unter den Buttons, über gesamte Breite) */
.value{
  grid-column:1 / 6;
  grid-row:2;

  font-size:22px;
  font-weight:900;
  max-width:100%;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  text-align:center;
}

/* =====================
   MAIN
   ===================== */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:18px;
  text-align:center;
}

.segmentName{
  font-size:5.8vw;
  font-weight:900;
}

.time{
  font-size:22vw;
  font-weight:900;
  line-height:1;
}

/* =====================
   ZEITBALKEN
   ===================== */
.barWrap{
  width:92vw;
  height:48px;
  border:4px solid rgba(0,0,0,0.4);
  border-radius:999px;
  overflow:hidden;
  background:rgba(255,255,255,0.35);
}
.bar{
  height:100%;
  width:0%;
  background:rgba(0,0,0,0.65);
}

/* =====================
   RESPONSIVE
   ===================== */
@media (max-width:900px){
  .pill{ font-size:72px; padding:10px 18px; }
  .top button{
    font-size:26px;
    max-width: 220px;
    min-height:90px;
  }
}
</style>
</head>

<body class="bg-song">
<div class="wrap">

  <div class="top">
    <button class="btn-start" onclick="start()">START</button>
    <button class="btn-stop"  onclick="pause()">STOP</button>

    <div class="pill" id="total">00:00</div>

    <button class="btn-prev"  onclick="prev()">ZURÜCK</button>
    <button class="btn-next"  onclick="next()">WEITER</button>

    <div class="value" id="title">–</div>
  </div>

  <div class="main">
    <div class="segmentName" id="name">–</div>
    <div class="time" id="time">00:00</div>
    <div class="barWrap"><div class="bar" id="bar"></div></div>
  </div>

</div>

<script>
/* ========= Doppeltipp-Zoom zusätzlich abfangen (iOS zickt manchmal) ========= */
(function(){
  let lastTouchEnd = 0;
  document.addEventListener('touchend', function(e){
    const now = Date.now();
    if (now - lastTouchEnd <= 350) {
      e.preventDefault(); // verhindert in vielen Fällen den Doppeltipp-Zoom
    }
    lastTouchEnd = now;
  }, { passive:false });
})();

/* =====================
   FINALER ABLAUF – 29:52
   ===================== */
var segments = [
  ["Für die Ewigkeit", 256],
  ["Übergang (zu Kölsche Jung)", 20],
  ["Kölsche Jung", 247],
  ["Moderation (zu Leeve Marie)", 40],
  ["Leeve Marie", 266],
  ["Moderation (zu Karnevalsmaus)", 80],
  ["Karnevalsmaus", 206],
  ["Moderation (zu Oben / Unten)", 80],
  ["Oben / Unten", 266],
  ["Abmoderation", 50],
  ["Nie mehr Fastelovend", 281]
];

var idx = 0;
var remaining = segments[0][1];
var running = false;
var timer = null;

function isTalk(name){
  name = name.toLowerCase();
  return name.indexOf("moderation") >= 0 ||
         name.indexOf("übergang") >= 0 ||
         name.indexOf("uebergang") >= 0 ||
         name.indexOf("abmoderation") >= 0;
}

function format(t){
  return String(Math.floor(t/60)).padStart(2,"0") + ":" +
         String(t%60).padStart(2,"0");
}

function totalRemaining(){
  var t = remaining;
  for (var i = idx + 1; i < segments.length; i++) t += segments[i][1];
  return t;
}

function updateUI(){
  var name = segments[idx][0];

  document.getElementById("title").textContent =
    (idx+1) + "/" + segments.length + " – " + name;

  document.getElementById("name").textContent = name;
  document.getElementById("time").textContent = format(remaining);
  document.getElementById("total").textContent = format(totalRemaining());

  var segLen = segments[idx][1];
  var pct = segLen > 0 ? 100 * (1 - remaining / segLen) : 100;
  document.getElementById("bar").style.width = pct + "%";

  document.body.className = "";
  if (isTalk(name)){
    if (remaining <= 10 && remaining > 0){
      document.body.classList.add("bg-alert","blink");
    } else {
      document.body.classList.add("bg-talk");
    }
  } else {
    document.body.classList.add("bg-song");
  }
}

function stopInterval(){
  if (timer !== null){
    clearInterval(timer);
    timer = null;
  }
}

function tick(){
  if (!running) return;

  remaining--;

  if (remaining <= 0){
    if (idx < segments.length - 1){
      idx++;
      remaining = segments[idx][1];
    } else {
      pause();
    }
  }
  updateUI();
}

function start(){
  if (running) return;
  running = true;
  stopInterval();
  timer = setInterval(tick, 1000);
}

function pause(){
  running = false;
  stopInterval();
}

function next(){
  var wasRunning = running;
  pause();
  if (idx < segments.length - 1) idx++;
  remaining = segments[idx][1];
  updateUI();
  if (wasRunning) start();
}

function prev(){
  var wasRunning = running;
  pause();
  if (idx > 0) idx--;
  remaining = segments[idx][1];
  updateUI();
  if (wasRunning) start();
}

updateUI();
</script>

</body>
</html>




