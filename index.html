<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">

<!-- Viewport + Zoom verhindern -->
<meta name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">

<!-- iOS Standalone (Home-Bildschirm Vollbild, wichtig fÃ¼r iOS 12.5) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BÃ¼hnen-Timer">

<title>BÃ¼hnen-Timer</title>

<style>
html, body{
  height:100%;
  margin:0;
  font-family:-apple-system,system-ui,Arial,sans-serif;
}

/* =====================
   HINTERGRUND-FARBEN
   ===================== */
body.bg-song{ background:#18b65a; color:#000; }
body.bg-talk{ background:#ffd500; color:#000; }
body.bg-alert{ background:#d60000; color:#fff; }
body{ transition:background 120ms linear; }

/* Blink */
@keyframes blink{
  0%{ filter:brightness(1); }
  50%{ filter:brightness(0.55); }
  100%{ filter:brightness(1); }
}
body.blink{ animation:blink 0.6s linear infinite; }

/* iOS Touch/Zoom-Feinschliff */
*{
  -webkit-tap-highlight-color: transparent;
}
button{
  touch-action: manipulation;
  -webkit-user-select:none;
  user-select:none;
}

/* =====================
   LAYOUT
   ===================== */
.wrap{
  height:100%;
  display:flex;
  flex-direction:column;
}

/* =====================
   TOP-BAR
   ===================== */
.top{
  height:170px;
  border-bottom:4px solid rgba(0,0,0,0.25);

  display:grid;
  align-items:center;
  grid-template-columns: 1fr 1fr auto 1fr 1fr;
  grid-template-rows: 1fr auto;
  gap:10px 14px;
  padding:10px 14px 12px;
  box-sizing:border-box;

  /* ðŸ”¥ PC & iPad angleichen */
  max-width:1400px;
  margin:0 auto;
}

/* =====================
   BUTTONS
   ===================== */
.top button{
  height:100%;
  min-height:110px;
  width:100%;
  max-width:260px;
  padding:0 18px;
  font-size:34px;
  font-weight:900;
  border-radius:18px;
  border:5px solid rgba(0,0,0,0.45);
  background:#fff;
  box-shadow:0 6px 0 rgba(0,0,0,0.35);
}

.top button:active{
  transform:translateY(4px);
  box-shadow:0 2px 0 rgba(0,0,0,0.4);
}

.btn-start{ grid-column:1; grid-row:1; }
.btn-stop { grid-column:2; grid-row:1; }
.btn-prev { grid-column:4; grid-row:1; }
.btn-next { grid-column:5; grid-row:1; }

/* =====================
   RESTLAUFZEIT
   ===================== */
.pill{
  grid-column:3;
  grid-row:1;
  justify-self:center;

  font-size:92px;
  font-weight:900;
  padding:10px 24px;
  border:5px solid #000;
  border-radius:22px;
  background:#fff;
  color:#000;
  line-height:1;
  box-shadow:0 8px 0 rgba(0,0,0,0.35);
}

/* Titel unter Buttons */
.value{
  grid-column:1 / 6;
  grid-row:2;
  font-size:22px;
  font-weight:900;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  text-align:center;
}

/* =====================
   MAIN
   ===================== */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:18px;
  text-align:center;
}

.segmentName{
  font-size:5.8vw;
  font-weight:900;
}

.time{
  font-size:22vw;
  font-weight:900;
  line-height:1;
}

/* =====================
   ZEITBALKEN
   ===================== */
.barWrap{
  width:92vw;
  height:48px;
  border:4px solid rgba(0,0,0,0.4);
  border-radius:999px;
  overflow:hidden;
  background:rgba(255,255,255,0.35);
}
.bar{
  height:100%;
  width:0%;
  background:rgba(0,0,0,0.65);
}

/* =====================
   RESPONSIVE
   ===================== */
@media (max-width:900px){
  .pill{ font-size:72px; padding:10px 18px; }
  .top button{
    font-size:26px;
    min-height:90px;
    max-width:220px;
  }
}
</style>
</head>

<body class="bg-song">
<div class="wrap">

  <div class="top">
    <button class="btn-start" onclick="start()">START</button>
    <button class="btn-stop"  onclick="pause()">STOP</button>

    <div class="pill" id="total">00:00</div>

    <button class="btn-prev" onclick="prev()">ZURÃœCK</button>
    <button class="btn-next" onclick="next()">WEITER</button>

    <div class="value" id="title">â€“</div>
  </div>

  <div class="main">
    <div class="segmentName" id="name">â€“</div>
    <div class="time" id="time">00:00</div>
    <div class="barWrap"><div class="bar" id="bar"></div></div>
  </div>

</div>

<script>
/* Doppeltipp-Zoom zusÃ¤tzlich abfangen */
(function(){
  let lastTouchEnd = 0;
  document.addEventListener('touchend', function(e){
    const now = Date.now();
    if (now - lastTouchEnd <= 350) e.preventDefault();
    lastTouchEnd = now;
  }, { passive:false });
})();

/* =====================
   ABLAUF â€“ 29:52
   ===================== */
var segments = [
  ["FÃ¼r die Ewigkeit", 256],
  ["Ãœbergang (zu KÃ¶lsche Jung)", 20],
  ["KÃ¶lsche Jung", 247],
  ["Moderation (zu Leeve Marie)", 40],
  ["Leeve Marie", 266],
  ["Moderation (zu Karnevalsmaus)", 80],
  ["Karnevalsmaus", 206],
  ["Moderation (zu Oben / Unten)", 80],
  ["Oben / Unten", 266],
  ["Abmoderation", 50],
  ["Nie mehr Fastelovend", 281]
];

var idx = 0;
var remaining = segments[0][1];
var running = false;
var timer = null;

function isTalk(name){
  name = name.toLowerCase();
  return name.includes("moderation") ||
         name.includes("Ã¼bergang") ||
         name.includes("uebergang") ||
         name.includes("abmoderation");
}

function format(t){
  return String(Math.floor(t/60)).padStart(2,"0") + ":" +
         String(t%60).padStart(2,"0");
}

function totalRemaining(){
  let t = remaining;
  for (let i = idx + 1; i < segments.length; i++) t += segments[i][1];
  return t;
}

function updateUI(){
  const name = segments[idx][0];
  document.getElementById("title").textContent =
    (idx+1) + "/" + segments.length + " â€“ " + name;

  document.getElementById("name").textContent = name;
  document.getElementById("time").textContent = format(remaining);
  document.getElementById("total").textContent = format(totalRemaining());

  const len = segments[idx][1];
  document.getElementById("bar").style.width =
    (len > 0 ? 100 * (1 - remaining / len) : 100) + "%";

  document.body.className = "";
  if (isTalk(name)){
    if (remaining <= 10 && remaining > 0){
      document.body.classList.add("bg-alert","blink");
    } else {
      document.body.classList.add("bg-talk");
    }
  } else {
    document.body.classList.add("bg-song");
  }
}

function stopInterval(){
  if (timer){ clearInterval(timer); timer=null; }
}

function tick(){
  if (!running) return;
  remaining--;
  if (remaining <= 0){
    if (idx < segments.length - 1){
      idx++;
      remaining = segments[idx][1];
    } else pause();
  }
  updateUI();
}

function start(){
  if (running) return;
  running = true;
  stopInterval();
  timer = setInterval(tick, 1000);
}

function pause(){
  running = false;
  stopInterval();
}

function next(){
  const wasRunning = running;
  pause();
  if (idx < segments.length - 1) idx++;
  remaining = segments[idx][1];
  updateUI();
  if (wasRunning) start();
}

function prev(){
  const wasRunning = running;
  pause();
  if (idx > 0) idx--;
  remaining = segments[idx][1];
  updateUI();
  if (wasRunning) start();
}

updateUI();
</script>

</body>
</html>
